<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script src="https://tonejs.github.io/build/Tone.js"></script>
<button>start</button>
<script>
/* global nn, Tone */

// ratios of intrvals for just intonation instead of equal tempermant
const ratios = [1, 1.125,	1.25,	4/3, 1.5, 5/3, 15/8, 2]

const pluck = new Tone.PluckSynth().toDestination()
const poly = new Tone.PolySynth().toDestination()
const metal = new Tone.MetalSynth().toDestination()

const tonic = nn.randomInt(300, 600)
let step = 0

function play(time) {
  play_chord(time)
  if (Math.random() > 0.7){
    play_note(time)
  }
  step++
}
function play_note (time) {
    const note = tonic * Math.random(ratios)
    if (note) {
     synth.triggerAttackRelease(note, '8n', time) 
    }
    
    if (s === 0) {
      poly.triggerAttackRelease(note, '2n', time)
    }

  }
  
  function toggle () {
    if (Tone.Transport.state === 'started') {
      Tone.Transport.stop()
      nn.get('button').content('start')
    } else {
      Tone.Transport.start()
      nn.get('button').content('stop')
    }
  }

  
  nn.get('button').on('click', toggle)
  Tone.Transport.bpm.value = nn.randomInt(70, 150)
  Tone.Transport.scheduleRepeat(time => play(time), '16n')